<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>iOS开发迎来机器学习的春天---TensorFlow</title>
  <meta name="description" content="	  ">
  <meta name="author" content="leopardpan">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="iOS开发迎来机器学习的春天---TensorFlow">
  <meta name="twitter:description" content="	  ">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="iOS开发迎来机器学习的春天---TensorFlow">
  <meta property="og:description" content="	  ">
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
  <link href="/assets/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://baixin.io/2016/07/iOSMachineLearning_TensorFlow/">
  <link rel="alternate" type="application/rss+xml" title="潘柏信" href="http://baixin.io/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />

<!-- 百度统计 -->
  
  <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?8ba1c6be0953b6f9c2ba38e57f615421";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
  </script>
  

<!-- google 统计 -->
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-84134159-3', 'auto');
      ga('send', 'pageview');
  </script>
  

</head>


  <body>

    <span class="mobile btn-mobile-menu">        
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">  博客主页
              </a>
            </i>
            
                <i class="nav-menu-item">

                  <a href="/archive" title="archive" class="btn-mobile-menu__icon">
                      所有文章
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      标签
                  </a>
                </i>
            
          </nav>
      </div>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <!-- 头像效果-start -->
        <div class="ih-item circle effect right_to_left">            
            <a href="/#blog" title="前往 潘柏信 的主页" class="blog-button">
                <div class="img"><img src="/assets/images/avatar.jpg" alt="img"></div>
                <div class="info">
                    <div class="info-back">
                        <h2> 
                            
                                leopardpan
                            
                        </h2>
                        <p>
                           
                                iOS / 机器学习
                            
                        </p>
                    </div>
                </div>
            </a>
        </div>
        <!-- 头像效果-end -->
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for 潘柏信" class="blog-button">潘柏信</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">个人站</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">欢迎来到我的个人站~</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        

        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客主页</a></li>
                
                  <li class="navigation__item"><a href="/archive" title="archive">所有文章</a></li>
                
                  <li class="navigation__item"><a href="/tags" title="tags">标签</a></li>
                
              </ul>
            </nav>
          </div>          
        </div>


        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-clear"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title">iOS开发迎来机器学习的春天---TensorFlow</h1>
    <div class="post-meta">
      <time datetime="2016-07-07 00:00:00 +0800" itemprop="datePublished" class="post-meta__date date">2016-07-07</time>
     
      <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <span id="busuanzi_container_page_pv">　　阅读：<span id="busuanzi_value_page_pv"></span>次</span>
    </p>
    </div>
  </header>

  <section class="post">
    <div align="center">
	<img src="/assets/images/tfimg/logo.jpg" height="300" width="500" />  
</div>

<p>　　<code class="highlighter-rouge">人工智能</code>、<code class="highlighter-rouge">机器学习</code>都已走进了我们的日常，尤其是愈演愈热的大数据更是跟我们的生活息息相关，做 <code class="highlighter-rouge">人工智能</code>、<code class="highlighter-rouge">数据挖掘</code>的人在其他人眼中感觉是很高大上的，总有一种遥不可及的感觉，在我司也经常会听到数据科学部的同事们提到 <code class="highlighter-rouge">机器学习</code>、<code class="highlighter-rouge">数据挖掘</code> 之类的词。但这些名词真的跟我们移动开发就没直接关系了吗？           <br />
　　作为移动开发者来说，无时无刻不被这些名词狠狠地敲打着脆弱的内心。💢 💢 💢  何时才能够将<code class="highlighter-rouge">机器学习</code>、<code class="highlighter-rouge">深度学习</code>应用在移动端，敲响移动端<code class="highlighter-rouge">机器学习</code>工业化的大门呢？</p>

<blockquote>
  <p>想象一下，某一天你身处一个完全陌生的环境，周围都是陌生的事物，而运行在iPhone的某个APP却对这个环境了如指掌，你要做的就是打开这个APP，输入你需要了解的事物，iPhone告诉你这个事物的信息，你也就没有了陌生事物了。世界就在眼前！</p>
</blockquote>

<p>如下图：</p>
<div align="center">
	<img src="/assets/images/tfimg/image02.png" height="300" width="480" />
</div>

<p>上面物体的识别准确率还是蛮不错的，基本识别出了键盘（49%的概率）、鼠标（46%的概率）和水杯（24%的概率）。</p>

<p>但是在某些事物的识别准确度方便却差强人意，比如下图：</p>

<div align="center">
　　<img src="/assets/images/tfimg/image01.png" height="300" width="320" />
</div>
<p>　　iPhone 6被识别成了iPod（59%的概率），而iPod的却是不怎么敢认（10%的概率）。想想最崩溃的估计是iPhone 6了，身价直接被降了好几个等级。</p>

<div align="center">
　　<img src="/assets/images/tfimg/wq.jpg" height="320" width="240" />  
</div>

<p>　　上面的例子来自于TensorFlow官方iOSDemo，暂且不评述TensorFlow的识别准确度如何，毕竟它还年轻，但是仅凭其识别能力的体现，也给机器学习在移动端的运用带来了无限的可能。</p>

<h3 id="tensorflowtf">一、TensorFlow（简称TF）</h3>

<p>　　去年，Google资深系统专家Jeff Dean在湾区机器学习大会上隆重介绍了其第二代深度学习系统<a href="http://www.tensorflow.org/">TensorFlow</a>，一时间网络上针对TensorFlow的文章铺天盖地，<a href="http://www.leiphone.com/news/201511/UDLyNds2oSTwM2yZ.html">揭秘TensorFlow：Google开源到底开的是什么？</a>、<a href="http://www.leiphone.com/news/201511/Voza1pFNQB4bzKdR.html">Google开源TensorFlow系统，这背后都有什么门道？</a>、<a href="http://www.zhihu.com/question/37243838">如何评价Google发布的第二代深度学习系统TensorFlow?</a>等等文章，TensorFlow的燎原之火一直在燃烧蔓延着，其<a href="https://github.com/tensorflow/tensorflow">GitHub上的开源库</a>在此文撰写时，也已经被<code class="highlighter-rouge">star：27550</code>，<code class="highlighter-rouge">fork：11054</code>了。🔥 🔥 🔥 🔥 🔥</p>

<p>不负众望，Google一直宣称平台移植性非常好的TensorFlow，终于在2016年6月27日，发布0.9版本，宣布移动端支持。<a href="https://developers.googleblog.com/2016/06/tensorflow-v09-now-available-with.html">TensorFlow v0.9 now available with improved mobile support</a>( 有墙💢 )，同时也给出了移动端的<a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/ios_examples">Demo</a>，对于代码为生的程序员，身处大数据处理为主导的<a href="http://www.talkingdata.com/">TalkingData</a>，也小试身手了一把，下载TensorFlow源码，查看编译指南，开始跳坑、填坑之路，也成就了此篇拙文的产生。</p>

<h3 id="tensorflowios">二、从TensorFlow到iOS静态库</h3>

<p>对于iOS平台下如何使用TensorFlow，TensorFlow给出了详细的编译脚本命令，详情请查看<a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/makefile">官方文档的命令</a>。</p>

<h5 id="section">第一步. 工具准备</h5>

<p><code class="highlighter-rouge">工欲善其事必先利其器</code>，在开始编译工作之前，需要准备一些编译所必须的工具：</p>

<ol>
  <li><a href="http://brew.sh/">Homebrew</a>: Mac os x 上包管理工具，具体使用方法可参考<a href="http://brew.sh/index_zh-cn.html">Doc</a>。</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>$ /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
</code></pre>
</div>

<ol>
  <li>Homebrew安装好之后，依次安装三个辅助性编译工具：</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>$ brew install libtool   
$ brew install autoconf   
$ brew install automake   
</code></pre>
</div>

<blockquote>
  <p>三个工具的含义，请参考：<a href="https://en.wikipedia.org/wiki/GNU_Libtool">https://en.wikipedia.org/wiki/GNU_Libtool</a></p>
</blockquote>

<h5 id="tensorflow">第二步. 克隆TensorFlow</h5>

<p>Google以<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a>开源协议将TensorFlow开源在<a href="https://github.com/tensorflow/tensorflow">GitHub</a>上，我们可以直接使用TensorFlow源码。</p>

<p>在任意你想存放TensorFlow源码的地方（建议不要放在桌面。^_^），clone项目。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ git clone https://github.com/tensorflow/tensorflow 
</code></pre>
</div>

<h5 id="section-1">第三步. 编译前准备</h5>

<p>　　在TensorFlow的<code class="highlighter-rouge">tensorflow/contrib/makefile/</code>目录下，有很多可使用的编译脚本，其中<code class="highlighter-rouge">build_all_ios.sh</code>脚本专门用来一键编译TensorFlow iOS静态库。虽然可以直接使用此脚本进行一键编译，但是因为有墙，某些依赖需要提前做处理。</p>

<ol>
  <li>
    <p>下载protobuf</p>

    <p>protobuf 是编译前唯一需要特殊处理的依赖库，<a href="https://github.com/google/protobuf/archive/master.zip">点击下载</a>，下载protobuf之后，解压，备用。</p>
  </li>
  <li>
    <p>下载googlemock</p>

    <p>虽然protobuf编译脚本<code class="highlighter-rouge">autogen.sh</code>中的googlemock链接地址<code class="highlighter-rouge">https://googlemock.googlecode.com/files/gmock-1.7.0.zip</code>无法直接下载到，但是细心的人会发现，在浏览器中输入<code class="highlighter-rouge">https://googlemock.googlecode.com/</code>地址后，会跳转到<code class="highlighter-rouge">https://github.com/google/googlemock</code>地址，google在GiHub上的仓库地址。而GitHub上的仓库，我们可以直接的下载，克隆等。</p>

    <p>我们直接在GitHub上下载googlemock(<a href="https://github.com/google/googlemock/archive/master.zip">点击下载</a>)，下载完成后，修改压缩包名字为<code class="highlighter-rouge">gmock-1.7.0.zip</code>，修改后将此压缩包移至上一步protobuf文件夹目录下，备用。</p>
  </li>
  <li>
    <p>修改下载依赖脚本，移除protobuf的下载</p>

    <p>在<code class="highlighter-rouge">tensorflow/contrib/makefile/</code>目录下，<code class="highlighter-rouge">download_dependencies.sh</code>脚本用来下载相关依赖，打开此脚本文件，注释掉或者直接删掉<code class="highlighter-rouge">git clone https://github.com/google/protobuf.git ${DOWNLOADS_DIR}/protobuf</code>部分，目的是不让脚本去下载protobuf。</p>

    <p>上面三步准备好后，接下来就进入静态库编译了。</p>
  </li>
</ol>

<h5 id="section-2">第四步. 一键编译</h5>

<p>　　前面已经知道在TensorFlow文件夹<code class="highlighter-rouge">tensorflow/contrib/makefile/</code>目录下的<code class="highlighter-rouge">build_all_ios.sh</code>脚本是用来编译iOS静态库的脚本，因此可以直接执行此脚本，开始静态库的编译工作了。</p>

<p>　　但是有一个问题大家可能会发现，由于编译TensorFlow需要用到protobuf，但是protobuf使我们自己手动下载的，该怎么让手动下载的protobuf能够直接让<code class="highlighter-rouge">build_all_ios.sh</code>脚本使用呢？</p>

<p>　　答案是<code class="highlighter-rouge">复制、粘贴</code>。可能有些low，但是有效。执行命令 <code class="highlighter-rouge">build_all_ios.sh</code>之后，立即把之前手动下载的protobuf文件夹拷贝进<code class="highlighter-rouge">tensorflow/contrib/makefile/downloads</code>目录。（放心，你拷贝的速度会很快，不会影响编译的执行的。^_^）</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ build_all_ios.sh    
</code></pre>
</div>

<p>　　一切准备就绪，接下来就是静静的等待编译完成了。在Mac编译的过程中，建议插上电源，最好不要让设备休眠断电，也最好不要去干别的东西，出去溜达一圈，回来后就看到战果了。</p>

<p>编译完成之后，会在<code class="highlighter-rouge">tensorflow/contrib/makefile/gen/</code>目录下看到编译的结果，关于这些静态库该如何使用，自己的项目如何应用，请参考<a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/ios_examples">TensorFlow iOS Examples</a>。</p>

<h3 id="section-3">三、遇到的问题</h3>

<p>1、googlecode.com被墙了，需要翻墙！（目前测试挂了VPN也没用），这也是上面编译前准备为什么要那么做的原因。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl: (7) Failed to connect to googlemock.googlecode.com port 443: Operation timed out
</code></pre>
</div>

<p>解决： 请参考 『第三步. 编译前准备』。</p>

<p>2、没有Xcode。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>xcrun: error: SDK "iphoneos" cannot be located
xcrun: error: SDK "iphoneos" cannot be located
xcrun: error: unable to lookup item 'PlatformPath' in SDK 'iphoneos'
+ IPHONEOS_PLATFORM=
</code></pre>
</div>

<p>解决：安装Xcode，从上面报错的命令中可以看到，在编译静态库的过程中使用了<code class="highlighter-rouge">xcrun</code>，而此命令是xCode本身具有的能力。</p>

<p>3、你的Xcode版本不是7.3或以后，或者你有多个Xcode，而默认的安装路径版本不是7.3或以后。</p>

<p><code class="highlighter-rouge">
error: Xcode 7.3.0 or later is required.
+ exit 1
</code>/</p>

<p>解决：更新Xcode至最新版本，并且保证默认路径下是最新/版本。</p>

<p>如果Xcode是7.3，并且没有条件更新Xcode，你可以修改<code class="highlighter-rouge">tensorflow/contrib/makefile/compile_ios_tensorflow.sh</code> 里的<code class="highlighter-rouge">REQUIRED_XCODE_VERSION=7.3.0</code>，为<code class="highlighter-rouge">REQUIRED_XCODE_VERSION=7.3</code>。（这样修改，目前还不确定会不会带来一些其他影响，最好是升级你的Xcode）</p>

<p><a href="http://baixin.io/2016/07/iOSMachineLearning_TensorFlow/">点击阅读原文</a></p>

<h3 id="section-4">四、参考链接</h3>

<ul>
  <li><a href="http://tensorfly.cn/">TensorFlow 中文社区</a></li>
  <li><a href="https://www.tensorflow.org/mobile.html">TensorFlow for Mobile</a></li>
  <li><a href="http://chenrudan.github.io/blog/2015/11/18/comparethreeopenlib.html">Caffe、TensorFlow、MXnet三个开源库对比</a></li>
  <li><a href="http://weibo.com/p/1001603907610737775666">如何评价Tensorflow和其它深度学习系统</a></li>
  <li><a href="http://www.algorithmdog.com/%E8%B0%81%E5%B0%86%E5%A4%BA%E5%8F%96%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%B7%A5%E4%B8%9A%E6%A0%87%E5%87%86%E7%9A%84%E8%8D%A3%E8%80%80">深度学习框架大战正在进行，谁将夺取“深度学习工业标准”的荣耀？</a></li>
</ul>


  </section>
</article>

<section>
       <ul class="pager">
        
        <li class="previous">
            <a href="/2016/07/MachineLearning_introduce/" data-toggle="tooltip" data-placement="top" title="机器学习入门（名词科普）">上一篇：  <span>机器学习入门（名词科普）</span>
            </a>
        </li>
        
        
        <li class="next">
            <a href="/2016/07/GitTutorial/" data-toggle="tooltip" data-placement="top" title="Git教程1">下一篇：  <span>Git教程1</span>
            </a>
        </li>
        
    </ul>
</section>

<section class="post-comments">

  
    <div class="ds-thread" data-thread-key="/2016/07/iOSMachineLearning_TensorFlow/" data-title="iOS开发迎来机器学习的春天---TensorFlow" data-url="http://baixin.io/2016/07/iOSMachineLearning_TensorFlow/"></div>

    <script type="text/javascript">
        var duoshuoQuery = {short_name:"leopard"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
  
  
  
  
</section>


            <section class="footer">
    <footer>
        <div class = "footer_div">  
        <nav class="cover-navigation navigation--social">
          <ul class="navigation">

          
          <!-- Weibo -->
          <li class="navigation__item_social">
            <a href="http://weibo.com/5366874726" title="@5366874726 的微博" target="_blank">
              <i class='social fa fa-weibo fa-2x'></i>
              <span class="label">Weibo</span>
            </a>
          </li>
          

          
          <!-- Github -->
          <li class="navigation__item_social">
            <a href="https://github.com/leopardpan" title="@leopardpan 的 Github" target="_blank">
              <i class='social fa fa-github fa-2x'></i>
              <span class="label">Github</span>
            </a>
          </li>
          
          
          

          

          <!-- RSS -->
          <li class="navigation__item_social">
            <a href="/feed.xml" rel="author" title="RSS" target="_blank">
              <i class='social fa fa-rss fa-2x'></i>
              <span class="label">RSS</span>
            </a>
          </li>

          
          <!-- Email -->
          <li class="navigation__item_social">
            <a href="mailto:leopardpan@icloud.com" title="Contact me">
              <i class='social fa fa-envelope fa-2x'></i>
              <span class="label">Email</span>
            </a>
          </li>
          

          </ul>
        </nav>

        </div>

        <div class = "footer_div">  
           <p class="copyright text-muted">
            Copyright &copy; 潘柏信 2016 Theme by <a href="http://baixin.io/">leopardpan</a> |
            <iframe
                style="margin-left: 2px; margin-bottom:-5px;"
                frameborder="0" scrolling="0" width="91px" height="20px"
                src="https://ghbtns.com/github-btn.html?user=leopardpan&repo=leopardpan.github.io&type=star&count=true" >
            </iframe>
            </p>
        	<div align="right">
    			<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
    			<span id="busuanzi_value_page_pv"></span> 本站访问：<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> 次
          	</div>
        <div>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
