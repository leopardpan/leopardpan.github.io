I" $<p>ä¸»è¦åŒ…æ‹¬æ—¥å¿—æ–‡ä»¶ä»‹ç»ä»¥åŠå¿«é€Ÿä½¿ç”¨ï¼Œæ–‡ä»¶å°è£…ï¼Œæ—¥å¿—é…ç½®æ–‡ä»¶é‡æ„ï¼Œæ—¥å¿—å·¥å…·ç±»åº”ç”¨ç­‰ç­‰å†…å®¹ã€‚</p>

<h1 id="æ—¥å¿—æ–‡ä»¶">æ—¥å¿—æ–‡ä»¶</h1>
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p>loggingæ¨¡å—æ˜¯Pythonå†…ç½®çš„æ ‡å‡†æ¨¡å—ï¼Œä¸»è¦ç”¨äºè¾“å‡ºè¿è¡Œæ—¥å¿—ï¼Œå¯ä»¥è®¾ç½®è¾“å‡ºæ—¥å¿—çš„ç­‰çº§/æ—¥å¿—ä¿å­˜è·¯å¾„ç­‰</p>
<h2 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h2>
<p>åœ¨testcaseæ–‡ä»¶å¤¹ä¸‹é¢ï¼Œæ–°å»ºt_logæ–‡ä»¶å¤¹ï¼Œåˆ›å»ºlog_demo.pyæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å­˜å‚¨æ—¥å¿—æœ‰å…³çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<pre><code class="language-python"># 1. å¯¼å…¥logging
import logging
# 2. set the basic information
logging.basicConfig(level = logging.INFO,format='%(asctime)s-%(levelname)s-%(message)s') 
# format: æ—¶é—´-æ—¥å¿—ç­‰çº§-æ—¥å¿—ä¿¡æ¯ %æ‹¬å·é‡Œé¢çš„å†…å®¹å¯ä»¥è‡ªå®šä¹‰
# level: INFOè¡¨ç¤ºï¼Œåªæœ‰INFOçº§åˆ«çš„æ—¥å¿—æ‰ä¼šè¢«è¾“å‡ºï¼Œå¦‚INFOï¼ŒWARNINGï¼ŒERRORï¼ŒCRITICAL
# å¦‚æœæ˜¯DEBUGçº§åˆ«çš„æ—¥å¿—ï¼Œå°±ä¸ä¼šè¢«è¾“å‡º
#3ã€å®šä¹‰æ—¥å¿—åç§°getlogger
logger = logging.getLogger("log_demo")
#4ã€info,debug
logger.info("info") # åªæœ‰INFOçº§åˆ«çš„æ—¥å¿—æ‰ä¼šè¢«è¾“å‡º
logger.debug("debug") # ä¸ä¼šè¢«è¾“å‡º
logger.warning("warning") # WARNINGçº§åˆ«çš„æ—¥å¿—ä¼šè¢«è¾“å‡º
</code></pre>

<pre><code>æ‰§è¡Œè¿™æ®µä»£ç ï¼Œç»“æœå¦‚ä¸‹ï¼š
```console
2023-01-17 09:28:54,466-INFO-info
2023-01-17 09:28:54,466-WARNING-warning
</code></pre>

<h3 id="æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°æ–‡ä»¶æŒ‡å®šæ–‡ä»¶">æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œæ–‡ä»¶ï¼ŒæŒ‡å®šæ–‡ä»¶</h3>
<ol>
  <li>è®¾ç½®loggeråç§°</li>
  <li>è®¾ç½®loggerçº§åˆ«</li>
  <li>åˆ›å»ºhandlerï¼Œç”¨äºè¾“å‡ºæ§åˆ¶å°æˆ–è€…å†™å…¥æ—¥å¿—æ–‡ä»¶</li>
  <li>è®¾ç½®æ—¥å¿—çº§åˆ«</li>
  <li>å®šä¹‰handlerçš„è¾“å‡ºæ ¼å¼</li>
  <li>ç»™loggeræ·»åŠ handler</li>
</ol>

<p>åœ¨testcaseæ–‡ä»¶å¤¹ä¸‹é¢çš„t_logæ–‡ä»¶å¤¹ä¸‹é¢ï¼Œåˆ›å»ºlog_file_demo.pyæ–‡ä»¶,è¾“å‡ºåˆ°æ§åˆ¶å°.</p>

<pre><code class="language-python"># è¾“å‡ºåˆ°æ§åˆ¶å°
import logging
# 1. è®¾ç½®loggeråç§°
logger = logging.getLogger("log_file_demo")
# 2. è®¾ç½®loggerçº§åˆ«,è¿™é‡Œè®¾ç½®ä¸ºINFOï¼Œåªæœ‰INFOçº§åˆ«çš„æ—¥å¿—æ‰ä¼šè¢«è¾“å‡º
logger.setLevel(logging.INFO)
# 3. åˆ›å»ºhandlerï¼Œç”¨äºè¾“å‡ºæ§åˆ¶å°æˆ–è€…å†™å…¥æ—¥å¿—æ–‡ä»¶
fh_stream = logging.StreamHandler() # StreamHandlerè¡¨ç¤ºè¾“å‡ºåˆ°æ§åˆ¶å°
# 4. è®¾ç½®æ—¥å¿—çº§åˆ«
fh_stream.setLevel(logging.INFO) 
# 5. å®šä¹‰handlerçš„è¾“å‡ºæ ¼å¼ï¼Œè¿™é‡Œè®¾ç½®ä¸ºæ—¶é—´-æ—¥å¿—ç­‰çº§-æ—¥å¿—ä¿¡æ¯
formatter =  logging.Formatter('%(asctime)s %(name)s %(levelname)s')
fh_stream.setFormatter(formatter)
# 6. ç»™loggeræ·»åŠ handlerï¼Œè¿™é‡Œæ·»åŠ çš„æ˜¯fh_stream,ä¹Ÿå°±æ˜¯è¾“å‡ºåˆ°æ§åˆ¶å°,å¦‚æœæƒ³è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œå¯ä»¥æ·»åŠ fh_file
logger.addHandler(fh_stream)
#7ã€è¿è¡Œè¾“å‡º
logger.info("this is a info")
logger.debug("this is a debug")
logger.warning("this is a warning")
</code></pre>

<p>åœ¨æ§åˆ¶å°æŸ¥çœ‹è¾“å‡ºç»“æœï¼š</p>
<pre><code class="language-console">2023-01-17 10:04:31,711 log_file_demo INFO
2023-01-17 10:04:31,711 log_file_demo WARNING
</code></pre>

<p>è¾“å‡ºåˆ°æ–‡ä»¶ï¼š</p>
<pre><code class="language-python">#è¾“å‡ºåˆ°æ–‡ä»¶
import logging
#1ã€è®¾ç½®loggeråç§°
logger = logging.getLogger("log_file_demo")
#2ã€è®¾ç½®logçº§åˆ«
logger.setLevel(logging.INFO)
#3ã€åˆ›å»ºhandler
#å†™å…¥æ–‡ä»¶
fh_file = logging.FileHandler("./test.log")
#4ã€è®¾ç½®æ—¥å¿—çº§åˆ«
fh_file.setLevel(logging.WARNING)
#5ã€å®šä¹‰è¾“å‡ºæ ¼å¼
formatter = logging.Formatter('%(asctime)s %(name)s %(levelname)s %(message)s ')
fh_file.setFormatter(formatter)
#6ã€æ·»åŠ handler
logger.addHandler(fh_file)
#7ã€è¿è¡Œè¾“å‡º
logger.info("this is a info")
logger.debug("this is a debug")
logger.warning("this is a warning")
</code></pre>

<p>ç»“æœä¼šè¾“å‡ºåˆ°åŒæ–‡ä»¶ç›®å½•ä¸‹çš„test.logæ–‡ä»¶ä¸­ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-console">2023-01-17 10:07:10,826 log_file_demo WARNING this is a warning 
</code></pre>
<p>ä¸ºå•¥è¿™é‡Œåªæœ‰warningçº§åˆ«çš„æ—¥å¿—è¢«è¾“å‡ºåˆ°æ–‡ä»¶ä¸­å‘¢ï¼Ÿ
è™½ç„¶æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºINFOï¼Œä½†æ˜¯åœ¨æ·»åŠ handlerçš„æ—¶å€™ï¼Œè®¾ç½®äº†æ—¥å¿—çº§åˆ«ä¸ºWARNINGï¼Œæ‰€ä»¥åªæœ‰WARNINGçº§åˆ«çš„æ—¥å¿—ä¼šè¢«è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚</p>

<h4 id="formatæ ¼å¼è¯´æ˜">Formatæ ¼å¼è¯´æ˜</h4>

<table>
  <thead>
    <tr>
      <th style="text-align: left">æ ¼å¼</th>
      <th style="text-align: left">è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">%(name)s</td>
      <td style="text-align: left">Loggerçš„åå­—</td>
    </tr>
    <tr>
      <td style="text-align: left">%(levelno)s</td>
      <td style="text-align: left">æ•°å­—å½¢å¼çš„æ—¥å¿—çº§åˆ«</td>
    </tr>
    <tr>
      <td style="text-align: left">%(levelname)s</td>
      <td style="text-align: left">æ–‡æœ¬å½¢å¼çš„æ—¥å¿—çº§åˆ«</td>
    </tr>
    <tr>
      <td style="text-align: left">%(pathname)s</td>
      <td style="text-align: left">è°ƒç”¨æ—¥å¿—è¾“å‡ºå‡½æ•°çš„æ¨¡å—çš„å®Œæ•´è·¯å¾„åï¼Œå¯èƒ½æ²¡æœ‰</td>
    </tr>
    <tr>
      <td style="text-align: left">%(filename)s</td>
      <td style="text-align: left">è°ƒç”¨æ—¥å¿—è¾“å‡ºå‡½æ•°çš„æ¨¡å—çš„æ–‡ä»¶å</td>
    </tr>
    <tr>
      <td style="text-align: left">%(asctime)s</td>
      <td style="text-align: left">å­—ç¬¦ä¸²å½¢å¼çš„å½“å‰æ—¶é—´ã€‚é»˜è®¤æ ¼å¼æ˜¯â€œ2003-07-08 16:49:45,896â€ã€‚é€—å·åé¢çš„æ˜¯æ¯«ç§’</td>
    </tr>
    <tr>
      <td style="text-align: left">%(message)s</td>
      <td style="text-align: left">ç”¨æˆ·è¾“å‡ºçš„æ¶ˆæ¯</td>
    </tr>
  </tbody>
</table>

<h2 id="æ—¥å¿—æ–‡ä»¶çš„å°è£…">æ—¥å¿—æ–‡ä»¶çš„å°è£…</h2>

<ol>
  <li>å°è£…Logå·¥å…·ç±»
åœ¨utilsæ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»ºLogUtil.pyæ–‡ä»¶ï¼Œå°è£…Logå·¥å…·ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>

<pre><code class="language-python"># åˆ›å»ºç±»
import logging
# å®šä¹‰æ—¥å¿—çº§åˆ«å…³ç³»æ˜ å°„
# å®šä¹‰ä¹‹åï¼Œå°±å¯ä»¥ç”¨log_l[self.log_level]å»æ›´æ–°åŸæ¥çš„self.log_level
log_l = {
    "debug":logging.DEBUG,
     "info":logging.INFO,
     "warning":logging.WARNING,
     "error":logging.ERROR
}
class Logger:
# å®šä¹‰å‚æ•°
## è¾“å‡ºæ–‡ä»¶åç§°ï¼ŒLoggername,æ—¥å¿—çº§åˆ«
    def __init__(self,log_file,log_name,log_level):
        self.log_file = log_file
        self.log_name = log_name
        self.log_level = log_level
        # ç¼–å†™è¾“å‡ºæ§åˆ¶å°æˆ–è€…æ–‡ä»¶ï¼Œåˆ©ç”¨ä¹‹å‰å†™å¥½çš„log_file_demo.py
       #1ã€è®¾ç½®loggeråç§°
        self.logger = logging.getLogger(self.log_name)
        #2ã€è®¾ç½®logçº§åˆ«
        self.logger.setLevel(log_l[self.log_level])
        # é¦–å…ˆåˆ¤æ–­handleræ˜¯å¦å­˜åœ¨     åˆ›å»ºhandler
        if not self.logger.handlers:

         formatter = logging.Formatter('%(asctime)s %(name)s %(levelname)s %(message)s ')
         # è¾“å‡ºåˆ°æ§åˆ¶å°
         fh_stream = logging.StreamHandler()
         fh_stream.setLevel(log_l[self.log_level])
         fh_stream.setFormatter(formatter)
     
         #å†™å…¥æ–‡ä»¶
         fh_file = logging.FileHandler(self.log_file)
         fh_file.setLevel(log_l[self.log_level])
         fh_file.setFormatter(formatter)
         #6ã€æ·»åŠ handler
         self.logger.addHandler(fh_file)
         self.logger.addHandler(fh_stream)

</code></pre>
<ol>
  <li>é‡æ„é…ç½®æ–‡ä»¶</li>
</ol>

<p>æ ¹æ®æˆ‘ä»¬å°è£…çš„LogUtil.pyæ–‡ä»¶ï¼Œé‡æ„é…ç½®æ–‡ä»¶ï¼Œéœ€è¦çš„é…ç½®ä¿¡æ¯åŒ…æ‹¬: log_file,log_lovel</p>

<p>log_nameä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä¸å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚</p>

<p>æ‰“å¼€configæ–‡ä»¶å¤¹ä¸‹é¢çš„conf.ymlæ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®ä¿¡æ¯ï¼Œæ·»åŠ å¦‚ä¸‹ä¿¡æ¯ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-yaml">BASE:
  # log
  log_level: "debug"
  log_extension: ".log"
</code></pre>

<p>ç„¶åä¿®æ”¹config.pyæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç (ç¬¬ä¸€æ­¥ï¼Œå®šä¹‰logsæ–‡ä»¶è·¯å¾„ï¼›ç¬¬äºŒæ­¥ï¼Œè·å–è¯¥Logæ–‡ä»¶è·¯å¾„ï¼›ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®è¯¥è·¯ç»è·å–æ—¥å¿—çº§åˆ«å’Œæ–‡ä»¶æ‰©å±•åï¼š</p>
<pre><code class="language-python"># å®šä¹‰logsæ–‡ä»¶è·¯å¾„
_log_path = base_dir + os.sep + "logs" #ä¸‹åˆ’çº¿å¼€å¤´çš„å˜é‡ï¼Œè¡¨ç¤ºç§æœ‰å˜é‡
# è·å–è¯¥Logæ–‡ä»¶è·¯å¾„
def get_log_path():
    """
    è·å–logæ–‡ä»¶è·¯å¾„
    """
    return _log_path
# æ ¹æ®è¯¥è·¯ç»è·å–æ—¥å¿—çº§åˆ«å’Œæ–‡ä»¶æ‰©å±•å
def get_conf_log(self):
    return self.config["BASE"]["log_level"]
# è·å–æ–‡ä»¶æ‰©å±•å
def get_config_log_extension(self):
    return self.config["BASE"]["log_extension"]
</code></pre>

<p>æµ‹è¯•ä»¥ä¸‹ï¼Œåœ¨config.pyæ–‡ä»¶çš„if <strong>name</strong> == â€˜<strong>main</strong>â€˜:ä¸­æ‰§è¡Œä»£ç ï¼š</p>
<pre><code class="language-python">if __name__ == '__main__':
    conf_read = ConfigYaml()
    # print(conf_read.get_conf_url())
    print(conf_read.get_conf_log())
    print(conf_read.get_config_log_extension())
</code></pre>
<ol>
  <li>æ—¥å¿—å·¥å…·åº”ç”¨</li>
</ol>

<p>åœ¨LogUtil.pyæ–‡ä»¶ä¸­ï¼Œé¦–å…ˆåˆå§‹åŒ–å‚æ•°æ•°æ®ï¼Œç„¶åå¯¹å¤–æä¾›æ–¹æ³•ï¼Œåˆå§‹åŒ–logå·¥å…·ç±»ï¼Œæä¾›å…¶ä»–ç±»ä½¿ç”¨ã€‚</p>

<pre><code class="language-python">from config import config
from config.config import ConfigYaml
import datetime
import os

# åˆå§‹åŒ–å‚æ•°æ•°æ®
# æ—¥å¿—æ–‡ä»¶è·¯å¾„
log_path = config.get_log_path()
# è·å–å½“å‰æ—¶é—´
current_time = datetime.datetime.now().strftime("%Y-%m-%d")
# è·å–æ‰©å±•å
log_extension = ConfigYaml.get_config_log_extension()
logfile = os.path.join(log_path+current_time+log_extension)
# æ—¥å¿—æ–‡ä»¶çº§åˆ«
loglevel = ConfigYaml.get_conf_log()

# 2. å¯¹å¤–æ–¹æ³•ï¼Œåˆå§‹åŒ–logå·¥å…·ç±»ï¼Œæä¾›å…¶ä»–ç±»ä½¿ç”¨
def my_log():
    return Logger(log_file=logfile,log_name=log_name,log_level=loglevel).logger

if __name__ == "__main__":
    my_log().debug("this is a bug")

</code></pre>
:ET