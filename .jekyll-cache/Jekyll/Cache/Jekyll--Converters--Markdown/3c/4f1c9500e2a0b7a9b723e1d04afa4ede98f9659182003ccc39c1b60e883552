I"¡<h2 id="1-ä»€ä¹ˆæ˜¯stable-diffusion">1. ä»€ä¹ˆæ˜¯stable diffusionï¼Ÿ</h2>

<h2 id="2-ç¯å¢ƒæ­å»º">2. ç¯å¢ƒæ­å»º</h2>

<p><a href="https://www.python.org/ftp/python/3.10.6/python-3.10.6-amd64.exe">python3.10.6</a></p>

<p>ä¹Ÿå¯ä»¥ä»python releaseé¡µé¢ä¸‹è½½:
<a href="https://www.python.org/downloads/windows/">https://www.python.org/downloads/windows/</a></p>

<p>é¡¹ç›®åœ°å€ï¼š
<a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui">stable diffusion</a></p>

<p>æ‹‰å–åˆ°æœ¬åœ°ï¼š</p>

<pre><code class="language-bash">https://github.com/AUTOMATIC1111/stable-diffusion-webui.git
</code></pre>

<p>å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š</p>

<p>windowsä¸‹å·²ç»å­˜åœ¨äº†å…¶ä»–çš„pythonç‰ˆæœ¬ï¼Œè¦å…ˆåˆ‡æ¢é»˜è®¤çš„pythonç‰ˆæœ¬ï¼š</p>

<pre><code class="language-bash">py --version # æŸ¥çœ‹å½“å‰é»˜è®¤çš„pythonç‰ˆæœ¬
py -0p # æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­å®‰è£…çš„pythonç‰ˆæœ¬
py -3.x -m ensurepip --default-pip # åˆ‡æ¢é»˜è®¤çš„pythonç‰ˆæœ¬
</code></pre>

<p>æˆ–è€…æ‰¾åˆ°â€œç³»ç»Ÿå±æ€§â€ï¼Œç‚¹å‡»â€œç¯å¢ƒå˜é‡â€ï¼Œåœ¨â€œç³»ç»Ÿå˜é‡â€ä¸­æ‰¾åˆ°â€œPathâ€ï¼Œåœ¨â€œPathâ€ä¸­åº”è¯¥å·²ç»æœ‰äº†ä¸¤ä¸ªpythonè·¯å¾„ï¼Œåˆ é™¤å…¶ä¸­ä¸€ä¸ªpythonè·¯å¾„æˆ–è€…æŠŠå…¶ä¸­æƒ³è¦çš„è·¯å¾„ä¸Šç§»åˆ°æœ€å‰é¢å³å¯ã€‚</p>

<p>å¦‚æœå·²ç»ç”¨äº†å…¶ä»–ç‰ˆæœ¬çš„pythonï¼Œè¦å…ˆå»stable-diffusion-webuiæ–‡ä»¶å¤¹ä¸‹é¢çš„venvåˆ é™¤æ‰€æœ‰æ–‡ä»¶å†è¿›è¡Œæ“ä½œã€‚</p>

<h2 id="ä¸‹è½½stable-diffusion">ä¸‹è½½stable diffusion</h2>

<p>è¿è¡Œwebui-user.batï¼Œç¬¬ä¸€æ¬¡ä¼šä¸‹è½½æ‰€éœ€è¦çš„whlå’Œä¾èµ–åŒ…ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œè€å¿ƒç­‰å¾…ã€‚</p>

<p>ç¬¬ä¸€æ¬¡è¿è¡Œå‡ºç°çš„é—®é¢˜ï¼š
gfpganå®‰è£…å¤±è´¥</p>

<p><a href="https://blog.csdn.net/weixin_40735291/article/details/129153398">è§£å†³æ–¹æ¡ˆ</a></p>

<ul>
  <li>æ— æ³•å®‰è£…gfpgançš„åŸå› æ˜¯<strong>ç½‘ç»œé—®é¢˜ï¼Œå°±ç®—å·²ç»ç§‘å­¦ä¸Šç½‘ï¼Œå¹¶è®¾ç½®ä¸ºå…¨å±€ï¼Œä¹Ÿæ— æ³•ä»githubä¸Šä¸‹è½½æºä»£ç ï¼Œä»è€Œå¯¼è‡´installå¤±è´¥ã€‚</strong></li>
  <li>è§£å†³æ–¹æ³•æ˜¯ç›´æ¥åˆ°githubä¸‹è½½ <a href="https://github.com/TencentARC/GFPGAN">GFPGAN</a> ä»£ç åˆ°æœ¬åœ°ï¼Œå¹¶è¿›è¡Œ <strong>æœ¬åœ°å®‰è£…</strong> ã€‚</li>
  <li>å› ä¸ºstable diffusionä¼šåœ¨å…¶æ ¹ç›®å½•åˆ›å»ºè™šæ‹Ÿpythonç¯å¢ƒvenvï¼Œå› æ­¤å®‰è£…æ–¹æ³•ä¸githubæœ‰æ‰€ä¸åŒã€‚å¯å‚è€ƒä»¥ä¸‹æ–¹æ³•ï¼š
    <ul>
      <li>ä»githubå°†GFPGANçš„æºæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè¿™ä¸€æ­¥å¯ä»¥ä½¿ç”¨git cloneä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½zipæ–‡ä»¶ã€‚ä¸‹è½½åï¼Œè§£å‹ï¼ˆå¦‚æœç”¨git cloneå°±ä¸éœ€è¦ï¼‰åˆ° <code>d:\\stable-diffusion-webui\venv\Scripts</code>ç›®å½•ä¸‹ï¼ˆstable-diffusion-webuiæ˜¯ä½ stable diffusion webuiçš„æ ¹ç›®å½•ï¼Œè¿™ä¸ªåœ°å€åªæ˜¯æˆ‘ç”µè„‘ä¸­çš„ï¼Œè¯·æ ¹æ®è‡ªå·±æ”¾çš„ä½ç½®è°ƒæ•´ï¼‰ã€‚</li>
      <li>æ‰“å¼€cmdï¼Œcdåˆ° <code>d:\\stable-diffusion-webui\venv\Scripts\GFPGAN-master</code>ä¸‹ã€‚</li>
      <li>ä½¿ç”¨å‘½ä»¤ <code>d:\\stable-diffusion-webui\venv\Scripts\python.exe -m pip install basicsr facexlib</code>å®‰è£…GFPGANçš„ä¾èµ–ã€‚</li>
      <li>å†ä½¿ç”¨ <code>d:\\stable-diffusion-webui\venv\Scripts\python.exe -m pip install -r requirements.txt</code>å®‰è£…GFPGANçš„ä¾èµ–ã€‚</li>
      <li>ä½¿ç”¨ <code>d:\\stable-diffusion-webui\venv\Scripts\python.exe setup.py develop</code>å®‰è£…GFPGANã€‚</li>
    </ul>
  </li>
</ul>

<p>å¦‚æœæ–‡ä»¶è·¯å¾„æœ‰ç©ºæ ¼ï¼Œè¦åŠ ä¸ŠåŒå¼•å·ã€‚
è¿™é‡Œçš„python.exe -mè¡¨ç¤ºä½¿ç”¨python.exeè¿™ä¸ªæ–‡ä»¶æ¥æ‰§è¡Œæ¨¡å—pipï¼Œä¹Ÿå°±æ˜¯pip.pyè¿™ä¸ªæ–‡ä»¶ã€‚</p>

<p>å®‰è£…open_clipå¤±è´¥</p>

<p><a href="https://www.bilibili.com/read/cv22604427/">è§£å†³æ–¹æ¡ˆ</a></p>

<p>è¿˜æœ‰å…¶ä»–ä¸€äº›å°é—®é¢˜ï¼Œå¾ˆå¥½è§£å†³çš„ã€‚</p>

<p>æ¯”å¦‚è¯´ä»githubä¸Šé¢æ‹‰å–Stability-AI
/stablediffusionå‡ºç° <code>Failed to connect to github.com port 443: Timed out</code>çš„é—®é¢˜ï¼Œå¯ä»¥æ¢å›½å†…çš„é•œåƒæºè§£å†³ã€‚</p>

<pre><code class="language-shell">git clone https://hub.fgit.gq/Stability-AI/stablediffusion.gitÂ "D:/software1/stable diffusion/stable-diffusion-webui/repositories/stable-diffusion-stability-ai" 
</code></pre>

<h2 id="è¿è¡Œstable-diffusion">è¿è¡Œstable diffusion</h2>

<p>è®­ç»ƒæ¨¡å‹æ—¶æŠ¥é”™ï¼š</p>

<p><code>torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 128.00 MiB (GPU 0; 4.00 GiB total capacity; 2.20 GiB already allocated; 44.64 MiB free; 2.41 GiB reserved in total by PyTorch) If reserved memory is &gt;&gt; allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF</code></p>

<p>è§£å†³æ–¹æ³•ï¼š</p>

<ol>
  <li>é™ä½batch_size</li>
  <li>æ¢æ˜¾å¡</li>
  <li>repositories\stable-diffusion-stability-ai\scripts\txt2img.py
    <ol>
      <li>parser.add_argumentçš„â€“n_samplesçš„defaultæ”¹ä¸º1</li>
      <li><code>model.to(device)</code>åæ·»åŠ  <code>.half()</code> æ²¡æ‰¾åˆ°è¿™ä¸ªåœ¨å“ª</li>
    </ol>
  </li>
  <li>1</li>
</ol>

<h2 id="civitai">Civitai</h2>

<p>è‡ªå·±è®­ç»ƒçš„ç…§ç‰‡ä¸å¤ªæ»¡æ„ï¼Œå¯ä»¥ç”¨Civitaiçš„æ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚</p>

<p>https://civitai.com/models/8109/ulzza</p>

<p>https://civitai.com/models/6424/chill</p>

<h2 id="å…¶ä»–">å…¶ä»–</h2>

<p>txt2imgåªæ˜¯stable diffusionæœ€ç®€å•çš„åŠŸèƒ½ï¼Œè¿˜å¯ä»¥img2imgç­‰ç­‰ã€‚</p>
:ET