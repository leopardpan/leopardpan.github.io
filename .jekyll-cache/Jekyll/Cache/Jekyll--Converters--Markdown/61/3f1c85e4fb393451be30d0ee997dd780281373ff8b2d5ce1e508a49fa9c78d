I"ı,<p>ä¸»è¦åŒ…æ‹¬pytestå®‰è£…ï¼›pyteståˆ›å»ºç®€å•çš„æµ‹è¯•ç”¨ä¾‹ï¼›pyteståŸºç¡€ä½¿ç”¨å¦‚å‡½æ•°çº§åˆ«çš„æ–¹æ³•å’Œç±»çº§åˆ«çš„æ–¹æ³•ï¼›pytestå¸¸è§æ’ä»¶å¦‚pytest-htmlå°†æµ‹è¯•ç»“æœä»¥htmlçš„å½¢å¼å±•ç¤ºå‡ºæ¥ï¼Œpytest-rerunfailureså¯ä»¥è¿›è¡Œæµ‹è¯•ä»£ç çš„å¤±è´¥é‡è¯•ï¼›pytestçš„æ•°æ®å‚æ•°åŒ–ï¼Œå¯ä»¥å®ä¹ åŒæ ·çš„æµ‹è¯•ç”¨ä¾‹å‡½æ•°å¯¹å¤šä¸ªè¾“å…¥çš„æµ‹è¯•æ•°æ®çš„æµ‹è¯•ï¼›æœ€åæ˜¯æ ¹æ®pytestè¿è¡ŒåŸåˆ™ä»¥åŠpytest.iniæŒ‡å®šæµ‹è¯•çš„æ–‡ä»¶å¤¹ï¼Œæµ‹è¯•å‡½æ•°ç­‰å¯¹ä¹‹å‰çš„æ¥å£æ¨¡å—å‡½æ•°è¿›è¡Œé‡æ„ï¼Œè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</p>

<h2 id="pytestå®‰è£…">pytestå®‰è£…</h2>

<p>åœ¨requirements.txtä¸­æ·»åŠ pytest</p>
<pre><code>pytest~=4.5.0
</code></pre>

<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ</p>
<pre><code class="language-bash">pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre>

<h2 id="pytestä½¿ç”¨">pytestä½¿ç”¨</h2>

<h3 id="åˆ›å»ºç®€å•çš„æµ‹è¯•ç”¨ä¾‹">åˆ›å»ºç®€å•çš„æµ‹è¯•ç”¨ä¾‹</h3>

<p>åœ¨testcaseæ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»ºæ–‡ä»¶å¤¹t_pytestï¼Œç„¶ååœ¨t_pytestæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºpytest_demo.pyæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<pre><code class="language-python">
import pytest

#1ã€åˆ›å»ºç®€å•æµ‹è¯•æ–¹æ³•
"""
1ã€åˆ›å»ºæ™®é€šæ–¹æ³•
2ã€ä½¿ç”¨pytestæ–­è¨€çš„æ–¹æ³•
"""
#æ™®é€šæ–¹æ³•
def func(x):
    return x+1

#æ–­è¨€çš„æ–¹æ³•
def test_a():
    print("---test_a----")
    assert func(3) == 5  #æ–­è¨€å¤±è´¥

def test_b():
    print("---test_b----")
    assert 1 #æ–­è¨€


#2ã€pytestè¿è¡Œ
"""
1ã€Pycharmä»£ç ç›´æ¥æ‰§è¡Œ
2ã€å‘½ä»¤è¡Œæ‰§è¡Œ
"""

#ä»£ç ç›´æ¥æ‰§è¡Œ
if __name__ == "__main__":
    pytest.main(["pytest_demo.py"])
</code></pre>

<p>åœ¨Pycharmä¸­ç›´æ¥è¿è¡Œpytest_demo.pyæ–‡ä»¶ï¼Œè¿˜å¯ä»¥å¢åŠ ä¸€äº›å‚æ•°ï¼š</p>
<pre><code class="language-python">#ä»£ç ç›´æ¥æ‰§è¡Œ
import pytest
if __name__ == "__main__":
    pytest.main(["-s","pytest_demo.py"]) # -så‚æ•°å¯ä»¥æ‰“å°printçš„å†…å®¹
</code></pre>
<p>åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä»£ç ï¼Œæ“ä½œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-bash"># è¿›å…¥åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹
cd testcase/t_pytest
# æ‰§è¡Œä»£ç 
python pytest_demo.py
</code></pre>
<p>æµ‹è¯•ç»“æœä¸€ä¸ªé€šè¿‡ï¼Œä¸€ä¸ªå¤±è´¥</p>

<pre><code class="language-console">============================= test session starts ==============================
collecting ... collected 2 items

pytest_demo.py::test_a FAILED                                            [ 50%]---test_a----

testcase/t_pytest/pytest_demo.py:13 (test_a)
4 != 5

é¢„æœŸ:5
å®é™…:4
&lt;ç‚¹å‡»ä»¥æŸ¥çœ‹å·®å¼‚&gt;

def test_a():
        print("---test_a----")
&gt;       assert func(3) == 5  #æ–­è¨€å¤±è´¥
E       assert 4 == 5
E        +  where 4 = func(3)

pytest_demo.py:16: AssertionError




pytest_demo.py::test_b PASSED                                            [100%]---test_b----


========================= 1 failed, 1 passed in 0.04s ==========================

è¿›ç¨‹å·²ç»“æŸ,é€€å‡ºä»£ç 1
</code></pre>

<h2 id="pytestçš„åŸºç¡€ä½¿ç”¨">pytestçš„åŸºç¡€ä½¿ç”¨</h2>

<h3 id="å‡½æ•°çº§åˆ«çš„æ–¹æ³•">å‡½æ•°çº§åˆ«çš„æ–¹æ³•</h3>

<p>è¿è¡Œäºæµ‹è¯•æ–¹æ³•çš„å§‹æœ«ï¼Œè¿è¡Œä¸€æ¬¡æµ‹è¯•å‡½æ•°ä¼šè¿è¡Œä¸€æ¬¡ setup å’Œ teardownã€‚</p>

<p>åœ¨t_pytestæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºpytest_func.pyæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<pre><code class="language-python">
import pytest
"""
1ã€å®šä¹‰ç±»
2ã€åˆ›å»ºæµ‹è¯•æ–¹æ³•testå¼€å¤´
3ã€åˆ›å»ºsetup,teardown
4ã€è¿è¡ŒæŸ¥çœ‹ç»“æœ

"""

#1ã€å®šä¹‰ç±»
class TestFunc:
    #3ã€åˆ›å»ºsetup,teardown
    def setup(self):
        print("---setup----")

    def teardown(self):
        print("---teardown---")

    #2ã€åˆ›å»ºæµ‹è¯•æ–¹æ³•testå¼€å¤´
    def test_a(self):
        print("test_a")

    def test_b(self):
        print("test_b")

#4ã€è¿è¡ŒæŸ¥çœ‹ç»“æœ
if __name__ =="__main__":
    pytest.main(["-s","pytest_func.py"])
</code></pre>

<p>è¿”å›æ§åˆ¶å°ç»“æœå¦‚ä¸‹ï¼š</p>

<pre><code class="language-console">Testing started at ä¸Šåˆ10:37 ...
Launching pytest with arguments /home/hugo/PycharmProjects/InterAutoTest_W/testcase/t_pytest/pytest_func.py --no-header --no-summary -q in /home/hugo/PycharmProjects/InterAutoTest_W/testcase/t_pytest

============================= test session starts ==============================
collecting ... collected 2 items

pytest_func.py::TestFunc::test_a 
pytest_func.py::TestFunc::test_b 

======================== 2 passed, 4 warnings in 0.01s =========================

è¿›ç¨‹å·²ç»“æŸ,é€€å‡ºä»£ç 0
---setup----
PASSED                                  [ 50%]test_a
---teardown---
---setup----
PASSED                                  [100%]test_b
---teardown---
</code></pre>

<p>æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œåœ¨è¿è¡Œæ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹å‰éƒ½ä¼šè¿è¡Œsetupæ–¹æ³•ï¼Œè¿è¡Œå®Œæ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹åéƒ½ä¼šè¿è¡Œteardownæ–¹æ³•ã€‚</p>

<h3 id="ç±»çº§åˆ«æ–¹æ³•">ç±»çº§åˆ«æ–¹æ³•</h3>

<p>è¿è¡Œäºæµ‹è¯•ç±»çš„å§‹æœ«ï¼Œåœ¨ä¸€ä¸ªæµ‹è¯•å†…åªè¿è¡Œä¸€æ¬¡ setup_class å’Œ teardown_classï¼Œä¸å…³å¿ƒæµ‹è¯•ç±»å†…æœ‰å¤šå°‘ä¸ªæµ‹è¯•å‡½æ•°ã€‚</p>

<p>åœ¨t_pytestæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºpytest_class.pyæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<pre><code class="language-python">
import pytest
"""
1ã€å®šä¹‰ç±»
2ã€åˆ›å»ºæµ‹è¯•æ–¹æ³•testå¼€å¤´
3ã€åˆ›å»ºsetup_class,teardown_class
4ã€è¿è¡ŒæŸ¥çœ‹ç»“æœ

"""

#1å®šä¹‰ç±»
class TestClass:
    #3ã€åˆ›å»ºsetup_class,teardown_class
    def setup_class(self):
        print("---setup_class---")

    def teardown_class(self):
        print("---teardown_class---")

    #2ã€åˆ›å»ºæµ‹è¯•æ–¹æ³•testå¼€å¤´
    def test_a(self):
        print("test_a")

    def test_b(self):
        print("test_b")

#4ã€è¿è¡ŒæŸ¥çœ‹ç»“æœ
if __name__ =="__main__":
    pytest.main(["-s","pytest_class.py"])
</code></pre>

<p>è¿”å›ä¿¡æ¯å¦‚ä¸‹ï¼š</p>

<pre><code class="language-console">============================= test session starts ==============================
collecting ... collected 2 items

pytest_class.py::TestClass::test_a ---setup_class---
PASSED                                [ 50%]test_a

pytest_class.py::TestClass::test_b PASSED                                [100%]test_b
---teardown_class---


============================== 2 passed in 0.01s ===============================

è¿›ç¨‹å·²ç»“æŸ,é€€å‡ºä»£ç 0
</code></pre>

<p>æˆ‘ä»¬å‘ç°ï¼Œæ— è®ºæ‰§è¡Œå¤šå°‘ä¸ªæµ‹è¯•æ–¹æ³•ï¼Œsetup_classå’Œteardown_classæ–¹æ³•åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p>

<h2 id="pytestå¸¸ç”¨æ’ä»¶">pytestå¸¸ç”¨æ’ä»¶</h2>

<h3 id="pytest-html">pytest-html</h3>

<p>æµ‹è¯•æŠ¥å‘Šæ’ä»¶ï¼Œå¯ä»¥å°†æµ‹è¯•ç»“æœä»¥htmlçš„å½¢å¼å±•ç¤ºå‡ºæ¥ã€‚</p>

<p>å®‰è£…pytest-htmlæ’ä»¶ï¼Œåœ¨requirements.txtæ–‡ä»¶ä¸­æ·»åŠ pytest-htmlï¼Œç„¶ååœ¨ç»ˆç«¯ä¸­è¿è¡Œpip install -r requirements.txtå®‰è£…æ’ä»¶ã€‚</p>

<p>ä½¿ç”¨,åœ¨é…ç½®æ–‡ä»¶pytest.iniä¸­çš„å‘½ä»¤è¡Œå‚æ•°ä¸­å¢åŠ  â€“html=ç”¨æˆ·è·¯å¾„/report.html</p>

<pre><code class="language-console">[pytest]
addopts = -s --html=../../report/report.html
</code></pre>

<p>æ‰§è¡Œä¹‹å‰å†™å¥½çš„pytest_demo.pyæ–‡ä»¶ï¼ŒæŸ¥çœ‹ç”Ÿæˆçš„æµ‹è¯•æŠ¥å‘Šã€‚./../reportæ˜¯å›åˆ°æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªreportæ–‡ä»¶å¤¹ï¼Œreport.htmlæ˜¯ç”Ÿæˆçš„æµ‹è¯•æŠ¥å‘Šã€‚</p>

<h3 id="å¤±è´¥é‡è¯•">å¤±è´¥é‡è¯•</h3>

<p>è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬å¯èƒ½ä¼šä½¿ç”¨åˆ°ç½‘ç»œï¼Œå¦‚æœç½‘ç»œä¸å¥½å¯èƒ½æœ€ç»ˆä¼šä½¿è„šæœ¬ä¸é€šè¿‡ã€‚åƒè¿™ç§æƒ…å†µå¯èƒ½å¹¶ä¸æ˜¯è„šæœ¬æœ¬èº«çš„é—®é¢˜ï¼Œä»…ä»…æ˜¯å› ä¸ºç½‘ç»œå¿½å¿«å¿½æ…¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤±è´¥é‡è¯•çš„æ’ä»¶ï¼Œå½“å¤±è´¥åå°è¯•å†æ¬¡è¿è¡Œã€‚ä¸€èˆ¬æƒ…å†µæœ€ç»ˆæˆåŠŸå¯ä»¥è§†ä¸ºæˆåŠŸï¼Œä½†æœ€å¥½è¿›è¡Œè¿›è¡Œæ’æŸ¥æ—¶å€™æ˜¯è„šæœ¬é—®é¢˜ã€‚</p>

<p>å®‰è£…æ–¹æ³•ï¼šåœ¨requirements.txtæ–‡ä»¶ä¸­æ·»åŠ pytest-rerunfailuresï¼Œç„¶ååœ¨ç»ˆç«¯ä¸­è¿è¡Œpip install -r requirements.txtå®‰è£…æ’ä»¶ã€‚</p>

<p>ä½¿ç”¨æ–¹æ³•ï¼šåœ¨é…ç½®æ–‡ä»¶pytest.iniä¸­çš„å‘½ä»¤è¡Œå‚æ•°ä¸­å¢åŠ  â€“reruns=3,è¡¨ç¤ºå¤±è´¥ä¹‹åé‡è¯•3æ¬¡ã€‚é‡è¯•æ—¶ï¼Œå¦‚æœè„šæœ¬é€šè¿‡ï¼Œé‚£ä¹ˆåç»­ä¸å†é‡è¯•ã€‚</p>

<pre><code class="language-console">[pytest]
addopts =-s --html=../../report/report.html --reruns 3
</code></pre>

<p>ä¹Ÿå¯ä»¥åŠ reruns-delayå‚æ•°ï¼Œè¡¨ç¤ºå¤±è´¥ä¹‹åé‡è¯•çš„é—´éš”æ—¶é—´ã€‚</p>

<pre><code class="language-console">[pytest]
addopts =-s --html=../../report/report.html --reruns 3 --reruns-delay 2
</code></pre>

<p>é™¤äº†åœ¨pytest.iniä¸­é…ç½®ï¼Œä¹Ÿå¯ä»¥æ·»åŠ markæ ‡è®°ï¼Œåœ¨æµ‹è¯•ç”¨ä¾‹ä¸­æ·»åŠ @mark.flaky(reruns=3,reruns_delay=2)ï¼Œå¯ä»¥åªå¯¹æŸä¸ªæµ‹è¯•ç”¨ä¾‹è¿›è¡Œå¤±è´¥é‡è¯•ã€‚
@markæ˜¯è£…é¥°å™¨ï¼Œflakyè¡¨ç¤ºæ ‡è®°ã€‚</p>

<h2 id="æ•°æ®å‚æ•°åŒ–">æ•°æ®å‚æ•°åŒ–</h2>

<p>åº”ç”¨åœºæ™¯</p>

<p>ç™»å½•åŠŸèƒ½éƒ½æ˜¯è¾“å…¥ç”¨æˆ·åï¼Œè¾“å…¥å¯†ç ï¼Œç‚¹å‡»ç™»å½•ã€‚ä½†ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç å¦‚æœæƒ³æµ‹è¯•å¤šä¸ªå€¼æ˜¯æ²¡æœ‰åŠæ³•ç”¨æ™®é€šçš„æ“ä½œå®ç°çš„ã€‚æ•°æ®å‚æ•°åŒ–å¯ä»¥å¸®æˆ‘å®ç°è¿™æ ·çš„æ•ˆæœã€‚</p>

<p>æ–¹æ³•å
pytest.mark.parametrize(argnames,argvalues,indirect=False,ids=None,scope=None)</p>

<p>argnamesï¼šå‚æ•°å</p>

<p>argvaluesï¼šå‚æ•°å¯¹åº”å€¼ï¼Œç±»å‹å¿…é¡»ä¸ºå¯è¿­ä»£ç±»å‹ï¼Œä¸€èˆ¬ä½¿ç”¨list</p>

<p>indirectï¼šæ˜¯å¦å¯¹å‚æ•°å€¼è¿›è¡Œé—´æ¥è°ƒç”¨ï¼Œå¦‚æœä¸ºTrueï¼Œé‚£ä¹ˆå‚æ•°å€¼å¿…é¡»æ˜¯å‡½æ•°åï¼Œå¦åˆ™æŠ¥é”™;</p>

<p>idsï¼šå‚æ•°å€¼å¯¹åº”çš„idï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆé»˜è®¤ä½¿ç”¨å‚æ•°å€¼ï¼Œå¦‚æœæŒ‡å®šï¼Œé‚£ä¹ˆå‚æ•°å€¼å¿…é¡»å’Œidsçš„é•¿åº¦ä¸€è‡´ï¼Œå¦åˆ™æŠ¥é”™;</p>

<p>scopeï¼šå‚æ•°å€¼çš„ä½œç”¨åŸŸï¼Œå¯ä»¥æ˜¯functionã€classã€moduleã€sessionï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆé»˜è®¤ä¸ºfunction.</p>

<p>ä»¥ä¸‹æ˜¯ä¼ å…¥å•ä¸ªå‚æ•°çš„ä¾‹å­ï¼š</p>

<pre><code class="language-python">import pytest

"""
1ã€åˆ›å»ºç±»å’Œæµ‹è¯•æ–¹æ³•
2ã€åˆ›å»ºæ•°æ®
3ã€åˆ›å»ºå‚æ•°åŒ–
4ã€è¿è¡Œ
"""
#1ã€åˆ›å»ºç±»å’Œæµ‹è¯•æ–¹æ³•
class TestDemo:
    # 2ã€åˆ›å»ºæµ‹è¯•æ•°æ®
    data_list = ["xiaoming","xiaohong"]

    # 3ã€å‚æ•°åŒ–
    @pytest.mark.parametrize("name",data_list)
    
    # 1ã€åˆ›å»ºç±»å’Œæµ‹è¯•æ–¹æ³•
    def test_a(self,name):
        print("test_a")
        print(name)
        assert 1

if __name__ == "__main__":
    pytest.main(["pytest_one.py"])
</code></pre>

<p>ä»¥ä¸‹æ˜¯å¤šä¸ªå‚æ•°çš„ä¾‹å­ï¼šå¤šä¸ªå‚æ•°æ˜¯ä»¥å…ƒç¥–çš„æ–¹å¼ä¼ å…¥çš„ï¼Œå…ƒç¥–ä¸­çš„æ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªå‚æ•°ã€‚@pytest.mark.parametrizeï¼ˆï¼ˆâ€˜param1â€™,â€™param2â€™ï¼‰,[(value1[0],value1[1]),(value2[0],value2[1])]ï¼‰</p>

<pre><code class="language-python">import pytest

"""
1ã€åˆ›å»ºç±»å’Œæµ‹è¯•æ–¹æ³•
2ã€åˆ›å»ºæ•°æ®
3ã€åˆ›å»ºå‚æ•°åŒ–
4ã€è¿è¡Œ
"""
#1ã€åˆ›å»ºç±»å’Œæµ‹è¯•æ–¹æ³•
class TestDemo:
    #2ã€åˆ›å»ºæµ‹è¯•æ•°æ®
    data_list = [("xiaoming","123456"),("xiaohong","456789")]

    #3ã€å‚æ•°åŒ–
    @pytest.mark.parametrize(("name","password"),data_list)
    def test_a(self,name,password):
        print("test_a")
        print(name,password)
        assert 1

if __name__ == "__main__":
    pytest.main(["pytest_two.py"])
</code></pre>

<h2 id="åˆ©ç”¨pytestæ¥è¿›è¡Œæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•">åˆ©ç”¨pytestæ¥è¿›è¡Œæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•</h2>

<p>pytestè¿è¡ŒåŸåˆ™ï¼šåœ¨ä¸æŒ‡å®šè¿è¡Œç›®å½•ï¼Œè¿è¡Œæ–‡ä»¶ï¼Œè¿è¡Œå‡½æ•°ç­‰å‚æ•°çš„é»˜è®¤æƒ…å†µä¸‹ï¼Œpytestä¼šæ‰§è¡Œå½“å‰ç›®å½•ä¸‹æ‰€æœ‰ä»¥testä¸ºå‰ç¼€(test<em>.py)æˆ–è€…ä»¥_testç»“å°¾(</em>_test.py)çš„æ–‡ä»¶ä¸­ä»¥testå¼€å¤´çš„æµ‹è¯•æ–¹æ³•ã€‚</p>

<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®é»˜è®¤è¿è¡ŒåŸåˆ™ï¼Œè°ƒæ•´pyæ–‡ä»¶å‘½åï¼Œå‡½æ•°å‘½åï¼ˆæ¯”å¦‚æ‰€ä¹‹å‰çš„login():æ”¹æˆtest_login():ï¼Œä¹Ÿå°±ç®—é‡æ„æˆ‘ä»¬ä¹‹å‰çš„äº”ä¸ªæ¥å£æ¨¡å—ã€‚ ç„¶åï¼Œpytest.main()è¿è¡Œï¼Œæˆ–è€…å‘½ä»¤è¡Œç›´æ¥pytestè¿è¡Œã€‚</p>

<p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡pytest.iniæ–‡ä»¶æ¥é…ç½®è¿è¡Œå‚æ•°ï¼Œæ¯”å¦‚æŒ‡å®šè¿è¡Œæ–‡ä»¶ï¼Œè¿è¡Œå‡½æ•°ç­‰ã€‚</p>

<p>pytest.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>

<pre><code class="language-python">[pytest]
# æŒ‡å®šè¿è¡Œè·¯å¾„
testpaths = ./testcase
# æŒ‡å®šæ‰§è¡Œç›®å½•ä¸‹çš„æ–‡ä»¶
python_files = test_*.py
# æŒ‡å®šæ‰§è¡Œæµ‹è¯•ç±»
python_classes = Test*
# æŒ‡å®šæ‰§è¡Œæµ‹è¯•æ–¹æ³•
python_functions = test_*
</code></pre>
:ET